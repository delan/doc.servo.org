<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Eventfd based implementation of the ping event source."><title>calloop::sources::ping::eventfd - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="calloop" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0 (f8297e351 2025-10-28)" data-channel="1.91.0" data-search-js="search-e256b49e.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-6dc2a7f3.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module eventfd</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../calloop/index.html">calloop</a><span class="version">0.13.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module eventfd</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#implementation-notes" title="Implementation notes">Implementation notes</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In calloop::<wbr>sources::<wbr>ping</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../../index.html">calloop</a>::<wbr><a href="../../index.html">sources</a>::<wbr><a href="../index.html">ping</a></div><h1>Module <span>eventfd</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/calloop/sources/ping/eventfd.rs.html#1-194">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Eventfd based implementation of the ping event source.</p>
<h2 id="implementation-notes"><a class="doc-anchor" href="#implementation-notes">Â§</a>Implementation notes</h2>
<p>The eventfd is a much lighter signalling mechanism provided by the Linux
kernel. Rather than write an arbitrary sequence of bytes, it only has a
64-bit counter.</p>
<p>To avoid closing the eventfd early, we wrap it in a RAII-style closer
<code>CloseOnDrop</code> in <code>make_ping()</code>. When all the senders are dropped, another
wrapper <code>FlagOnDrop</code> handles signalling this to the event source, which is
the sole owner of the eventfd itself. The senders have weak references to
the eventfd, and if the source is dropped before the senders, they will
simply not do anything (except log a message).</p>
<p>To differentiate between regular ping events and close ping events, we add 2
to the counter for regular events and 1 for close events. In the source we
can then check the LSB and if itâ€™s set, we know it was a close event. This
only works if a close event never fires more than once.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.ArcAsFd.html" title="struct calloop::sources::ping::eventfd::ArcAsFd">ArcAsFd</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="struct" href="struct.FlagOnDrop.html" title="struct calloop::sources::ping::eventfd::FlagOnDrop">Flag<wbr>OnDrop</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>This manages signalling to the PingSource when itâ€™s dropped. There should
only ever be one of these per PingSource.</dd><dt><a class="struct" href="struct.Ping.html" title="struct calloop::sources::ping::eventfd::Ping">Ping</a></dt><dt><a class="struct" href="struct.PingSource.html" title="struct calloop::sources::ping::eventfd::PingSource">Ping<wbr>Source</a></dt></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.INCREMENT_CLOSE.html" title="constant calloop::sources::ping::eventfd::INCREMENT_CLOSE">INCREMENT_<wbr>CLOSE</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="constant" href="constant.INCREMENT_PING.html" title="constant calloop::sources::ping::eventfd::INCREMENT_PING">INCREMENT_<wbr>PING</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.drain_ping.html" title="fn calloop::sources::ping::eventfd::drain_ping">drain_<wbr>ping</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="fn" href="fn.make_ping.html" title="fn calloop::sources::ping::eventfd::make_ping">make_<wbr>ping</a></dt><dt><a class="fn" href="fn.send_ping.html" title="fn calloop::sources::ping::eventfd::send_ping">send_<wbr>ping</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl></section></div></main></body></html>