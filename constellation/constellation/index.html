<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The `Constellation`, Servoâ€™s Grand Central Station"><title>constellation::constellation - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="constellation" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0 (f8297e351 2025-10-28)" data-channel="1.91.0" data-search-js="search-e256b49e.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-6dc2a7f3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module constellation</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../constellation/index.html">constellation</a><span class="version">0.0.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module constellation</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate constellation</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">constellation</a></div><h1>Module <span>constellation</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/constellation/constellation.rs.html#5-5691">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The <code>Constellation</code>, Servoâ€™s Grand Central Station</p>
<p>The constellation tracks all information kept globally by the
browser engine, which includes:</p>
<ul>
<li>
<p>The set of all <code>EventLoop</code> objects. Each event loop is
the constellationâ€™s view of a script thread. The constellation
interacts with a script thread by message-passing.</p>
</li>
<li>
<p>The set of all <code>Pipeline</code> objects.  Each pipeline gives the
constellationâ€™s view of a <code>Window</code>, with its script thread and
layout.  Pipelines may share script threads.</p>
</li>
<li>
<p>The set of all <code>BrowsingContext</code> objects. Each browsing context
gives the constellationâ€™s view of a <code>WindowProxy</code>.
Each browsing context stores an independent
session history, created by navigation. The session
history can be traversed, for example by the back and forwards UI,
so each session history maintains a list of past and future pipelines,
as well as the current active pipeline.</p>
</li>
</ul>
<p>There are two kinds of browsing context: top-level ones (for
example tabs in a browser UI), and nested ones (typically caused
by <code>iframe</code> elements). Browsing contexts have a hierarchy
(typically caused by <code>iframe</code>s containing <code>iframe</code>s), giving rise
to a forest whose roots are top-level browsing context.  The logical
relationship between these types is:</p>
<div class="example-wrap"><pre class="language-text"><code>+------------+                      +------------+                 +---------+
|  Browsing  | ------parent?------&gt; |  Pipeline  | --event_loop--&gt; |  Event  |
|  Context   | ------current------&gt; |            |                 |  Loop   |
|            | ------prev*--------&gt; |            | &lt;---pipeline*-- |         |
|            | ------next*--------&gt; |            |                 +---------+
|            |                      |            |
|            | &lt;-top_level--------- |            |
|            | &lt;-browsing_context-- |            |
+------------+                      +------------+</code></pre></div>
<p>The constellation also maintains channels to other parts of Servo, including:</p>
<ul>
<li>The script thread.</li>
<li>The <code>Paint</code> subsystem, which runs in the same thread as the <code>Servo</code> instance.</li>
<li>The font cache, image cache, and resource manager, which load
and cache shared fonts, images, or other resources.</li>
<li>The service worker manager.</li>
<li>The devtools and webdriver servers.</li>
</ul>
<p>The constellation passes messages between the threads, and updates its state
to track the evolving state of the browsing context tree.</p>
<p>The constellation acts as a logger, tracking any <code>warn!</code> messages from threads,
and converting any <code>error!</code> or <code>panic!</code> into a crash report.</p>
<p>Since there is only one constellation, and its responsibilities include crash reporting,
it is very important that it does not panic.</p>
<p>Itâ€™s also important that the constellation not deadlock. In particular, we need
to be careful that we donâ€™t introduce any cycles in the can-block-on relation.
Blocking is typically introduced by <code>receiver.recv()</code>, which blocks waiting for the
sender to send some data. Servo tries to achieve deadlock-freedom by using the following
can-block-on relation:</p>
<ul>
<li>Constellation can block on <code>Paint</code></li>
<li>Constellation can block on embedder</li>
<li>Script can block on anything (other than script)</li>
<li>Blocking is transitive (if T1 can block on T2 and T2 can block on T3 then T1 can block on T3)</li>
<li>Nothing can block on itself!</li>
</ul>
<p>There is a complexity intoduced by IPC channels, since they do not support
non-blocking send. This means that as well as <code>receiver.recv()</code> blocking,
<code>sender.send(data)</code> can also block when the IPC buffer is full. For this reason it is
very important that all IPC receivers where we depend on non-blocking send
use a router to route IPC messages to an mpsc channel. The reason why that solves
the problem is that under the hood, the router uses a dedicated thread to forward
messages, and:</p>
<ul>
<li>Anything (other than a routing thread) can block on a routing thread</li>
</ul>
<p>See <a href="https://github.com/servo/servo/issues/14704">https://github.com/servo/servo/issues/14704</a></p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.BrowsingContextGroup.html" title="struct constellation::constellation::BrowsingContextGroup">Browsing<wbr>Context<wbr>Group</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>A browsing context group.</dd><dt><a class="struct" href="struct.Constellation.html" title="struct constellation::constellation::Constellation">Constellation</a></dt><dd>The <code>Constellation</code> itself. In the servo browser, there is one
constellation, which maintains all of the browser global data.
In embedded applications, there may be more than one constellation,
which are independent of each other.</dd><dt><a class="struct" href="struct.InitialConstellationState.html" title="struct constellation::constellation::InitialConstellationState">Initial<wbr>Constellation<wbr>State</a></dt><dd>State needed to construct a constellation.</dd><dt><a class="struct" href="struct.MessagePortInfo.html" title="struct constellation::constellation::MessagePortInfo">Message<wbr>Port<wbr>Info</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>Info related to a message-port tracked by the constellation.</dd><dt><a class="struct" href="struct.ScreenshotReadinessRequest.html" title="struct constellation::constellation::ScreenshotReadinessRequest">Screenshot<wbr>Readiness<wbr>Request</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="struct" href="struct.WebRenderWGPU.html" title="struct constellation::constellation::WebRenderWGPU">WebRenderWGPU</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>WebRender related objects required by WebGPU threads</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.ExitPipelineMode.html" title="enum constellation::constellation::ExitPipelineMode">Exit<wbr>Pipeline<wbr>Mode</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>When we are exiting a pipeline, we can either force exiting or not. A normal exit
waits for <code>Paint</code> to update its state before exiting, and delegates layout exit to
script. A forced exit does not notify <code>Paint</code>, and exits layout without involving
script.</dd><dt><a class="enum" href="enum.ScreenshotRequestState.html" title="enum constellation::constellation::ScreenshotRequestState">Screenshot<wbr>Request<wbr>State</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>When a <a href="struct.ScreenshotReadinessRequest.html" title="struct constellation::constellation::ScreenshotReadinessRequest"><code>ScreenshotReadinessRequest</code></a> is received from the renderer, the <a href="../struct.Constellation.html" title="struct constellation::Constellation"><code>Constellation</code></a>
go through a variety of states to process them. This data structure represents those states.</dd><dt><a class="enum" href="enum.TransferState.html" title="enum constellation::constellation::TransferState">Transfer<wbr>State</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>The state used by MessagePortInfo to represent the various states the port can be in.</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.WARNINGS_BUFFER_SIZE.html" title="constant constellation::constellation::WARNINGS_BUFFER_SIZE">WARNINGS_<wbr>BUFFER_<wbr>SIZE</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dd>The number of warnings to include in each crash report.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="type" href="type.PendingApprovalNavigations.html" title="type constellation::constellation::PendingApprovalNavigations">Pending<wbr>Approval<wbr>Navigations</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl></section></div></main></body></html>