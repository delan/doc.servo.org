<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Inline Formatting Context Layout"><title>layout::flow::inline - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="layout" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0 (f8297e351 2025-10-28)" data-channel="1.91.0" data-search-js="search-e256b49e.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-6dc2a7f3.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module inline</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../layout/index.html">layout</a><span class="version">0.0.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module inline</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#inline-formatting-context-layout" title="Inline Formatting Context Layout">Inline Formatting Context Layout</a><ul><li><a href="#box-tree-construction" title="Box Tree Construction">Box Tree Construction</a></li><li><a href="#box-to-line-layout" title="Box to Line Layout">Box to Line Layout</a></li><li><a href="#line-to-fragment-layout" title="Line to Fragment Layout">Line to Fragment Layout</a></li></ul></li></ul><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#statics" title="Statics">Statics</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In layout::<wbr>flow</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">layout</a>::<wbr><a href="../index.html">flow</a></div><h1>Module <span>inline</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/layout/flow/inline/mod.rs.html#5-2790">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="inline-formatting-context-layout"><a class="doc-anchor" href="#inline-formatting-context-layout">Â§</a>Inline Formatting Context Layout</h2>
<p>Inline layout is divided into three phases:</p>
<ol>
<li>Box Tree Construction</li>
<li>Box to Line Layout</li>
<li>Line to Fragment Layout</li>
</ol>
<p>The first phase happens during normal box tree constrution, while the second two phases happen
during fragment tree construction (sometimes called just â€œlayoutâ€).</p>
<h3 id="box-tree-construction"><a class="doc-anchor" href="#box-tree-construction">Â§</a>Box Tree Construction</h3>
<p>During box tree construction, DOM elements are transformed into a box tree. This phase collects
all of the inline boxes, text, atomic inline elements (boxes with <code>display: inline-block</code> or
<code>display: inline-table</code> as well as things like images and canvas), absolutely positioned blocks,
and floated blocks.</p>
<p>During the last part of this phase, whitespace is collapsed and text is segmented into
<a href="text_run/struct.TextRun.html" title="struct layout::flow::inline::text_run::TextRun"><code>TextRun</code></a>s based on script, chosen font, and line breaking opportunities. In addition, default
fonts are selected for every inline box. Each segment of text is shaped using HarfBuzz and
turned into a series of glyphs, which all have a size and a position relative to the origin of
the <a href="text_run/struct.TextRun.html" title="struct layout::flow::inline::text_run::TextRun"><code>TextRun</code></a> (calculated in later phases).</p>
<p>The code for this phase is mainly in <code>construct.rs</code>, but text handling can also be found in
<code>text_runs.rs.</code></p>
<h3 id="box-to-line-layout"><a class="doc-anchor" href="#box-to-line-layout">Â§</a>Box to Line Layout</h3>
<p>During the first phase of fragment tree construction, box tree items are laid out into
<a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s and fragmented based on line boundaries. This is where line breaking happens. This
part of layout fragments boxes and their contents across multiple lines while positioning floats
and making sure non-floated contents flow around them. In addition, all atomic elements are laid
out, which may descend into their respective trees and create fragments. Finally, absolutely
positioned content is collected in order to later hoist it to the containing block for
absolutes.</p>
<p>Note that during this phase, layout does not know the final block position of content. Only
during line to fragment layout, are the final block positions calculated based on the lineâ€™s
final content and its vertical alignment. Instead, positions and line heights are calculated
relative to the lineâ€™s final baseline which will be determined in the final phase.</p>
<p><a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s represent a particular set of content on a line. Currently this is represented by
a linear series of items that describe the lineâ€™s hierarchy of inline boxes and content. The
item types are:</p>
<ul>
<li><a href="line/enum.LineItem.html#variant.InlineStartBoxPaddingBorderMargin" title="variant layout::flow::inline::line::LineItem::InlineStartBoxPaddingBorderMargin"><code>LineItem::InlineStartBoxPaddingBorderMargin</code></a></li>
<li><a href="line/enum.LineItem.html#variant.InlineEndBoxPaddingBorderMargin" title="variant layout::flow::inline::line::LineItem::InlineEndBoxPaddingBorderMargin"><code>LineItem::InlineEndBoxPaddingBorderMargin</code></a></li>
<li><a href="line/enum.LineItem.html#variant.TextRun" title="variant layout::flow::inline::line::LineItem::TextRun"><code>LineItem::TextRun</code></a></li>
<li><a href="line/enum.LineItem.html#variant.Atomic" title="variant layout::flow::inline::line::LineItem::Atomic"><code>LineItem::Atomic</code></a></li>
<li><a href="line/enum.LineItem.html#variant.AbsolutelyPositioned" title="variant layout::flow::inline::line::LineItem::AbsolutelyPositioned"><code>LineItem::AbsolutelyPositioned</code></a></li>
<li><a href="line/enum.LineItem.html#variant.Float" title="variant layout::flow::inline::line::LineItem::Float"><code>LineItem::Float</code></a></li>
</ul>
<p>The code for this can be found by looking for methods of the form <code>layout_into_line_item()</code>.</p>
<h3 id="line-to-fragment-layout"><a class="doc-anchor" href="#line-to-fragment-layout">Â§</a>Line to Fragment Layout</h3>
<p>During the second phase of fragment tree construction, the final block position of <a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s
is calculated and they are converted into <a href="../../fragment_tree/fragment/enum.Fragment.html" title="enum layout::fragment_tree::fragment::Fragment"><code>Fragment</code></a>s. After layout, the <a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s are
discarded and the new fragments are incorporated into the fragment tree. The final static
position of absolutely positioned content is calculated and it is hoisted to its containing
block via <a href="../../positioned/struct.PositioningContext.html" title="struct layout::positioned::PositioningContext"><code>PositioningContext</code></a>.</p>
<p>The code for this phase, can mainly be found in <code>line.rs</code>.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="mod" href="construct/index.html" title="mod layout::flow::inline::construct">construct</a></dt><dt><a class="mod" href="inline_box/index.html" title="mod layout::flow::inline::inline_box">inline_<wbr>box</a></dt><dt><a class="mod" href="line/index.html" title="mod layout::flow::inline::line">line</a></dt><dt><a class="mod" href="line_breaker/index.html" title="mod layout::flow::inline::line_breaker">line_<wbr>breaker</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="text_run/index.html" title="mod layout::flow::inline::text_run">text_<wbr>run</a></dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.AnonymousBlockBox.html" title="struct layout::flow::inline::AnonymousBlockBox">Anonymous<wbr>Block<wbr>Box</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Each sequence of block-level boxes that participate in an inline formatting context
(because their parent is an inline box) gets wrapped inside an <a href="struct.AnonymousBlockBox.html" title="struct layout::flow::inline::AnonymousBlockBox"><code>AnonymousBlockBox</code></a>.
This way we donâ€™t have to deal with the block-levels directly.</dd><dt><a class="struct" href="struct.BaselineRelativeSize.html" title="struct layout::flow::inline::BaselineRelativeSize">Baseline<wbr>Relative<wbr>Size</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>A block size relative to a lineâ€™s final baseline. This is to track the size
contribution of a particular element of a line above and below the baseline.
These sizes can be combined with other baseline relative sizes before the
final baseline position is known. The values here are relative to the
overall lineâ€™s baseline and <em>not</em> the nested baseline of an inline box.</dd><dt><a class="struct" href="struct.ContentSizesComputation.html" title="struct layout::flow::inline::ContentSizesComputation">Content<wbr>Sizes<wbr>Computation</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>A struct which takes care of computing <a href="../../sizing/struct.ContentSizes.html" title="struct layout::sizing::ContentSizes"><code>ContentSizes</code></a> for an <a href="struct.InlineFormattingContext.html" title="struct layout::flow::inline::InlineFormattingContext"><code>InlineFormattingContext</code></a>.</dd><dt><a class="struct" href="struct.InlineContainerState.html" title="struct layout::flow::inline::InlineContainerState">Inline<wbr>Container<wbr>State</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.InlineContainerStateFlags.html" title="struct layout::flow::inline::InlineContainerStateFlags">Inline<wbr>Container<wbr>State<wbr>Flags</a></dt><dt><a class="struct" href="struct.InlineFormattingContext.html" title="struct layout::flow::inline::InlineFormattingContext">Inline<wbr>Formatting<wbr>Context</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.InlineFormattingContextLayout.html" title="struct layout::flow::inline::InlineFormattingContextLayout">Inline<wbr>Formatting<wbr>Context<wbr>Layout</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.LineBlockSizes.html" title="struct layout::flow::inline::LineBlockSizes">Line<wbr>Block<wbr>Sizes</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="struct" href="struct.LineUnderConstruction.html" title="struct layout::flow::inline::LineUnderConstruction">Line<wbr>Under<wbr>Construction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Information about the current line under construction for a particular
<a href="struct.InlineFormattingContextLayout.html" title="struct layout::flow::inline::InlineFormattingContextLayout"><code>InlineFormattingContextLayout</code></a>. This tracks position and size information while
<a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s are collected and is used as input when those <a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s are
converted into <a href="../../fragment_tree/fragment/enum.Fragment.html" title="enum layout::fragment_tree::fragment::Fragment"><code>Fragment</code></a>s during the final phase of line layout. Note that this
does not store the <a href="line/enum.LineItem.html" title="enum layout::flow::inline::line::LineItem"><code>LineItem</code></a>s themselves, as they are stored as part of the
nesting state in the <a href="struct.InlineFormattingContextLayout.html" title="struct layout::flow::inline::InlineFormattingContextLayout"><code>InlineFormattingContextLayout</code></a>.</dd><dt><a class="struct" href="struct.SegmentContentFlags.html" title="struct layout::flow::inline::SegmentContentFlags">Segment<wbr>Content<wbr>Flags</a></dt><dt><a class="struct" href="struct.SharedInlineStyles.html" title="struct layout::flow::inline::SharedInlineStyles">Shared<wbr>Inline<wbr>Styles</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd><a href="text_run/struct.TextRun.html" title="struct layout::flow::inline::text_run::TextRun"><code>TextRun</code></a> and <code>TextFragment</code>s need a handle on their parent inline box (or inline
formatting context root)â€™s style. In order to implement incremental layout, these are
wrapped in <a href="../../type.SharedStyle.html" title="type layout::SharedStyle"><code>SharedStyle</code></a>. This allows updating the parent box tree element without
updating every single descendant box tree node and fragment.</dd><dt><a class="struct" href="struct.UnbreakableSegmentUnderConstruction.html" title="struct layout::flow::inline::UnbreakableSegmentUnderConstruction">Unbreakable<wbr>Segment<wbr>Under<wbr>Construction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>The current unbreakable segment under construction for an inline formatting context.
Items accumulate here until we reach a soft line break opportunity during processing
of inline content or we reach the end of the formatting context.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.InlineItem.html" title="enum layout::flow::inline::InlineItem">Inline<wbr>Item</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="static" href="static.FONT_SUBSCRIPT_OFFSET_RATIO.html" title="static layout::flow::inline::FONT_SUBSCRIPT_OFFSET_RATIO">FONT_<wbr>SUBSCRIPT_<wbr>OFFSET_<wbr>RATIO</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="static" href="static.FONT_SUPERSCRIPT_OFFSET_RATIO.html" title="static layout::flow::inline::FONT_SUPERSCRIPT_OFFSET_RATIO">FONT_<wbr>SUPERSCRIPT_<wbr>OFFSET_<wbr>RATIO</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.char_prevents_soft_wrap_opportunity_when_before_or_after_atomic.html" title="fn layout::flow::inline::char_prevents_soft_wrap_opportunity_when_before_or_after_atomic">char_<wbr>prevents_<wbr>soft_<wbr>wrap_<wbr>opportunity_<wbr>when_<wbr>before_<wbr>or_<wbr>after_<wbr>atomic</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Whether or not this character will rpevent a soft wrap opportunity when it
comes before or after an atomic inline element.</dd><dt><a class="fn" href="fn.effective_vertical_align.html" title="fn layout::flow::inline::effective_vertical_align">effective_<wbr>vertical_<wbr>align</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.inline_container_needs_strut.html" title="fn layout::flow::inline::inline_container_needs_strut">inline_<wbr>container_<wbr>needs_<wbr>strut</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Whether or not a strut should be created for an inline container. Normally
all inline containers get struts. In quirks mode this isnâ€™t always the case
though.</dd><dt><a class="fn" href="fn.is_baseline_relative.html" title="fn layout::flow::inline::is_baseline_relative">is_<wbr>baseline_<wbr>relative</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.line_height.html" title="fn layout::flow::inline::line_height">line_<wbr>height</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.place_pending_floats.html" title="fn layout::flow::inline::place_pending_floats">place_<wbr>pending_<wbr>floats</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl></section></div></main></body></html>