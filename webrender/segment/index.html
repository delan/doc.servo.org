<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Primitive segmentation"><title>webrender::segment - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="webrender" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0 (f8297e351 2025-10-28)" data-channel="1.91.0" data-search-js="search-e256b49e.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-6dc2a7f3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module segment</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../webrender/index.html">webrender</a><span class="version">0.68.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module segment</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#overview" title="Overview">Overview</a><ul><li><a href="#segments-and-clipping" title="Segments and clipping">Segments and clipping</a></li></ul></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate webrender</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">webrender</a></div><h1>Module <span>segment</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/webrender/segment.rs.html#5-1387">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Primitive segmentation</p>
<h2 id="overview"><a class="doc-anchor" href="#overview">Â§</a>Overview</h2>
<p>Segmenting is the process of breaking rectangular primitives into smaller rectangular
primitives in order to extract parts that could benefit from a fast paths.</p>
<p>Typically this is used to allow fully opaque segments to be rendered in the opaque
pass. For example when an opaque rectangle has a non-axis-aligned transform applied,
we usually have to apply some anti-aliasing around the edges which requires alpha
blending. By segmenting the edges out of the center of the primitive, we can keep a
large amount of pixels in the opaque pass.
Segmenting also lets us avoids rasterizing parts of clip masks that we know to have
no effect or to be fully masking. For example by segmenting the corners of a rounded
rectangle clip, we can optimize both rendering the mask and the primitive by only
rasterize the corners in the mask and not applying any clipping to the segments of
the primitive that donâ€™t overlap the borders.</p>
<p>It is a flexible system in the sense that different sources of segmentation (for
example two rounded rectangle clips) can affect the segmentation, and the possibility
to segment some effects such as specific clip kinds does not necessarily mean the
primitive will actually be segmented.</p>
<h3 id="segments-and-clipping"><a class="doc-anchor" href="#segments-and-clipping">Â§</a>Segments and clipping</h3>
<p>Segments of a primitive can be either not clipped, fully clipped, or partially clipped.
In the first two case we donâ€™t need a clip mask. For each partially masked segments, a
mask is rasterized using a render task. All of the interesting steps happen during frame
building.</p>
<ul>
<li>The first step is to determine the segmentation and write the associated GPU data.
See <code>PrimitiveInstance::build_segments_if_needed</code> and <code>write_brush_segment_description</code>
in <code>prim_store/mod.rs</code> which uses the segment builder of this module.</li>
<li>The second step is to generate the mask render tasks.
See <code>BrushSegment::update_clip_task</code> and <code>RenderTask::new_mask</code>. For each segment that
needs a mask, the contribution of all clips that affect the segment is added to the
maskâ€™s render task.</li>
<li>Segments are assigned to batches (See <code>batch.rs</code>). Segments of a given primitive can
be assigned to different batches.</li>
</ul>
<p>See also the <a href="../clip/index.html"><code>clip</code> module documentation</a> for details about how clipping
information is represented.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.EdgeAaSegmentMask.html" title="struct webrender::segment::EdgeAaSegmentMask">Edge<wbr>AaSegment<wbr>Mask</a></dt><dd>Each bit of the edge AA mask is:
0, when the edge of the primitive needs to be considered for AA
1, when the edge of the segment needs to be considered for AA</dd><dt><a class="struct" href="struct.Event.html" title="struct webrender::segment::Event">Event</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="struct" href="struct.Item.html" title="struct webrender::segment::Item">Item</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="struct" href="struct.ItemFlags.html" title="struct webrender::segment::ItemFlags">Item<wbr>Flags</a></dt><dt><a class="struct" href="struct.ItemIndex.html" title="struct webrender::segment::ItemIndex">Item<wbr>Index</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="struct" href="struct.Segment.html" title="struct webrender::segment::Segment">Segment</a></dt><dt><a class="struct" href="struct.SegmentBuilder.html" title="struct webrender::segment::SegmentBuilder">Segment<wbr>Builder</a></dt></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.EventKind.html" title="enum webrender::segment::EventKind">Event<wbr>Kind</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.MAX_SEGMENTS.html" title="constant webrender::segment::MAX_SEGMENTS">MAX_<wbr>SEGMENTS</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.clamp.html" title="fn webrender::segment::clamp">clamp</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="fn" href="fn.emit_segment_if_needed.html" title="fn webrender::segment::emit_segment_if_needed">emit_<wbr>segment_<wbr>if_<wbr>needed</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl></section></div></main></body></html>